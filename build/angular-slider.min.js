/*
 angular-slider v0.3.2 
 (c) 2013-2014 Venturocket, Inc. http://github.com/Venturocket 
 License: MIT 
*/
angular.module("ghs.directives.slider",["ngTouch"]).directive("slider",["$timeout","$document","$interpolate","$swipe",function(a,b,c,d){"use strict";function e(a){return angular.element(a)}function f(a){return""+a+"px"}function g(a,b){return a.css({opacity:b})}function h(a){return g(a,0)}function i(a){return g(a,1)}function j(a,b){return a.css({left:b})}function k(a){var b=parseFloat(a.css("width"));return isNaN(b)?a[0].offsetWidth:b}function l(a){return k(a)/2}function m(a){try{return a.offset().left}catch(b){}return a[0].getBoundingClientRect().left}function n(a,b){return m(a)>m(b)?m(a)-m(b)-k(b):m(b)-m(a)-k(a)}function o(a,b){return a.attr("ng-bind-template",b)}function p(a,b,c,d,e){(angular.isUndefined(b)||!b)&&(b=0),(angular.isUndefined(c)||!c||0===c)&&(c=1/Math.pow(10,b)),(angular.isUndefined(d)||!d)&&(d=0),(angular.isUndefined(a)||!a)&&(a=0);var f=(a-d)%c,g=f>c/2?a+c-f:a-f;return(angular.isUndefined(e)||!e)&&(e=g),g=Math.min(Math.max(g,d),e),parseFloat(g.toFixed(b))}function q(a,b){return Math.floor(a/b+.5)*b}function r(a){return t+" "+a+" "+u}var s=3,t=c.startSymbol(),u=c.endSymbol();return{restrict:"EA",require:"ngModel",scope:{presetValues:"@",minLimit:"@",maxLimit:"@",step:"@",stepWidth:"@",precision:"@",stickiness:"@",showSteps:"@",ngModel:"=",ngDisabled:"=",ngChange:"&",translateFn:"&",scaleFn:"&",inverseScaleFn:"&",onStartFn:"&",onMoveFn:"&",onEndFn:"&"},template:'<span class="bar full"></span><span class="bar steps"><span class="bubble step" ng-repeat="step in stepBubbles()"></span></span><span class="pointer unselected low"></span><span class="bubble low"></span><span class="bubble minLimit"></span><span class="bubble maxLimit"></span>',compile:function(c,g){function t(a){a||(a=c);var b=[];return angular.forEach(a.children(),function(a){b.push(e(a))}),b}function u(a){return{fullBar:a[0],stepBubs:a[1],currPtr:a[2],currBub:a[3],minBub:a[4],maxBub:a[5]}}var v,w=g.showSteps,x=g.stepWidth?"stepWidth":"step",y="ngModel",z=["presetValues","minLimit","maxLimit","stickiness",y];return v=function(){for(var a=t(),b=[],c=0,d=a.length;d>c;c++){var f=a[c];f=e(f),f.css({"white-space":"nowrap",position:"absolute",display:"block","z-index":1}),b.push(f)}return b}(),v=u(v),g.translateFn&&g.$set("translateFn",""+g.translateFn+"(value)"),g.scaleFn&&g.$set("scaleFn",""+g.scaleFn+"(value)"),g.inverseScaleFn&&g.$set("inverseScaleFn",""+g.inverseScaleFn+"(value)"),v.fullBar.css({left:0,right:0}),o(v.stepBubs.children().eq(0),r("translation(step)")),o(v.maxBub,r("translation(maxLimit)")),o(v.minBub,r("translation(minLimit)")),o(v.currBub,r("translation("+y+")")),z.unshift("precision",x),w||v.stepBubs.children().remove(),{post:function(c,g,o,r){function v(){angular.forEach(z,function(a){"presetValues"===a?"string"==typeof c.presetValues&&(c.presetValues=JSON.parse(c.presetValues)):"object"!=typeof c[a]&&(c[a]=parseFloat(c[a])),"presetValues"===a&&c[a]?(c.minLimit=c.presetValues[0],c.maxLimit=c.presetValues[c.presetValues.length-1]):a===y?c.presetValues||(c[a]=p(c[a],c.precision,c[x],c.minLimit,c.maxLimit)):"stickiness"===a&&(isNaN(c.stickiness)?c.stickiness=s:c.stickiness<1&&(c.stickiness=1)),"presetValues"!==a&&(c.decodedValues[a]=c.decodeRef(a))}),B=k(A.fullBar),C=l(A.currPtr),D=m(A.fullBar),E=D+B-k(A.currPtr),F=E-D,G=c.minLimit,H=c.decodedValues.minLimit,I=c.maxLimit,J=c.decodedValues.maxLimit,K=I-G,L=J-H,M=q(L,c.decodedValues[x])}function w(){function a(a){return(a-D)/F*100}function o(a){var b=a-H;return K===L?b=q(b,c.decodedValues[x])/M:b/=L,100*b}function s(a){return a/(c.presetValues.length-1)*100}function t(a){return o(c.decode(a))}function u(a){return Math.round(a/100*(c.presetValues.length-1))/(c.presetValues.length-1)*100}function w(a){return Math.round(a/100*(c.presetValues.length-1))}function z(a){return f(a*F/100)}function G(a){return Math.min(Math.max(a,D),E)}function I(b){return j(b,z(a(G(m(b)))))}function J(a,b,d){var e=a>0?1:-1;return b=b?b:100,d?(Math.sin(Math.min(Math.abs(a/b),1)*Math.PI-Math.PI/2)+1)*e*b/6:e*Math.pow(Math.min(Math.abs(a/b*2),1),c.stickiness)*b/2}function P(){var b;b=c.presetValues?s(c.decodedValues[y]):o(c.decodedValues[y]);var d=t(c[y]+c[x])-b,e=b-t(c[y]-c[x]),f=b+J(N,N>0?d:e);j(A.currPtr,z(f)),j(A.currBub,z(a(m(A.currPtr)-l(A.currBub)+C)))}function Q(){I(A.currBub),n(A.minBub,A.currBub)<5?h(A.minBub):i(A.minBub),n(A.currBub,A.maxBub)<5?h(A.maxBub):i(A.maxBub)}function R(){N=0,V&&(P(),Q(),V.removeClass("active")),V=null,W=null,c.onEndFn&&c.onEndFn()}function S(b){V&&(c.$apply(function(){var d=b.clientX||b.x||b.changedTouches[0].clientX,e=G(d+D-m(g)-l(V)),f=a(e);if(c.presetValues)f=u(f),c.decodedValues[W]=w(f),c[W]=c.encode(c.decodedValues[W]);else{var h=c.encode(H+L*f/100);N=f,c[W]=h=p(h,c.precision,c[x],c.minLimit,c.maxLimit),c.decodedValues[W]=c.decodeRef(W),N-=t(h)}c.ngChange&&c.ngChange(),r.$setViewValue(c[y]),P(),Q()}),c.onMoveFn&&c.onMoveFn())}function T(a,b,d){c.ngDisabled&&c.ngDisabled===!0||(a.preventDefault(),V=b,W=d,V.addClass("active"),c.onStartFn&&c.onStartFn(),S(a))}function U(){var a=function(a,b,c){a=e(a),c=angular.isUndefined(c)?a:e(c),d.bind(a,{start:function(a,d){T(d,c,b)}})},c=function(a){a=e(a),d.bind(a,{move:function(a,b){S(b)},end:function(a,b){S(b),R()},cancel:function(a,b){R(b)}})};c(b),a(A.currPtr,y),a(A.currBub,y),a(A.minBub,y,A.currPtr),a(A.maxBub,y,A.currPtr),a(A.fullBar,y,A.currPtr)}var V,W;v(),j(A.minBub,0),j(A.maxBub,f(B-k(A.maxBub))),P(),Q(),O||(U(),O=!0)}var A=u(t(g));c.decodedValues={minLimit:0,maxLimit:0,step:0,stepWidth:0,precision:0,stickiness:0,ngModel:0},c.translation=function(a){return"object"!=typeof a&&(a=parseFloat(a).toFixed(c.precision)),angular.isUndefined(o.translateFn)?""+a:c.translateFn({value:a})},c.encode=function(a){return angular.isUndefined(o.scaleFn)||!o.scaleFn?c.presetValues?c.presetValues[a]:a:c.scaleFn({value:a})},c.decode=function(a){if(angular.isUndefined(o.inverseScaleFn)||!o.inverseScaleFn){if(c.presetValues){for(var b=0;b<c.presetValues.length;b++){if("object"==typeof c.presetValues[b]&&"object"==typeof a&&c.presetValues[b].value===a.value)return b;if(c.presetValues[b]===a)return b}return null}return a}return c.inverseScaleFn({value:a})},(!c.presetValues&&1!==Math.round(c.encode(c.decode(1)))||100!==Math.round(c.encode(c.decode(100))))&&console.warn("The scale and inverseScale functions are not perfect inverses: 1 = "+c.encode(c.decode(1))+"  100 = "+c.encode(c.decode(100))),c.decodeRef=function(a){return c.decode(c[a])},c.inputSteps=function(){return Math.pow(10,-1*c.precision)};for(var B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=1,N=0,O=!1,P=0;P<z.length;P++)c.$watch(z[P],w);e(window).bind("resize",w),c.$on("refreshSlider",function(){a(w)}),a(w)}}}}}]);